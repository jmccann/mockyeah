module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=20)}([function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("lodash/isPlainObject")},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("match-deep")},function(e,t){e.exports=require("@babel/runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("lodash/isEqual")},function(e,t){e.exports=require("cookie")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports=require("lodash/flatten")},function(e,t){e.exports=require("path-to-regexp")},function(e,t){e.exports=require("lodash/isRegExp")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("@babel/runtime/helpers/typeof")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},function(e,t,r){"use strict";r.r(t);var n=r(8),a=r.n(n),o=r(6),c=r.n(o),i=r(0),s=r.n(i),u=r(3),f=r.n(u),l=r(9),p=r.n(l),h=r(4),d=r(10),y=r.n(d),m=r(2),b=r.n(m),v=r(14),x=r.n(v),k=r(12),w=r.n(k),g=r(7),O=r.n(g),j=r(5),q=r.n(j),P=r(15),E=r.n(P),$=r(13),S=r.n($),D=r(16),R=r.n(D);function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(r,!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var H=/^(\/?https?.{3}[^/:?]+):/,L=/^(\/?https?).{3}/,N=/^(\/?https?.{3}[^/:?]+)~/,M=/^(\/?https?).{3}/,U=function(e){return e.replace(M,"$1://").replace(N,"$1:")},_=function(e){return e.replace(H,"$1~").replace(L,"$1~~~")},F=/^\//,A=/^(https?)%3A%2F%2F/,B=function(e){return/^\/+https?[:~][/~]{2}/.test(e)?U(function(e){return e.replace(F,"")}(e).replace(A,(function(e,t){return"".concat(t,"://")}))):e},K=function(e,t){if("function"==typeof e)return e;var r=b()(e)?C({},e):e;(e=b()(e)?C({},e):{url:e}).query=S()(e.query)?void 0:e.query,e.headers=S()(e.headers)?void 0:Object.entries(e.headers).reduce((function(e,t){var r=a()(t,2),n=r[0],o=r[1];return e[n.toLowerCase()]=o,e}),{}),e.method?"all"===e.method||"ALL"===e.method||"*"===e.method?delete e.method:"string"==typeof e.method&&(e.method=e.method.toLowerCase()):e.method="get";var n,o,c=C({},e),i=C({},e.$meta||{});if(i.original=r,i.originalNormal=c,e.path&&(e.url=e.path,delete e.path),"*"===e.url&&delete e.url,"string"==typeof e.url){e.url=B(e.url);var s=(n=e.url,/^https?:/.test(n)?(o=Object(h.parse)(n),n="".concat(o.protocol||"http:","//").concat(o.hostname).concat(o.port&&!["80","443"].includes(o.port)?":".concat(o.port):"").concat(o.pathname)):(o=Object(h.parse)("http://example.com".concat(n.startsWith("/")?n:"/".concat(n))),n=o.pathname||""),{url:n,query:o.query?y.a.parse(o.query):void 0});if(e.url=s.url.replace(/\/+$/,""),e.url=e.url||"/",c.url=e.url,!t){var u=[],f=E()(_(e.url),u);e.url=function(e){return f.test(_(e)||_("/".concat(e)))},i.regex=f,i.matchKeys=u,i.fn=e.url.toString()}e.query=b()(e.query)?C({},s.query,{},e.query):e.query||s.query}else if(R()(e.url)){if(!t){var l=e.url;e.url=function(e){return l.test(U(e))||l.test(U("/".concat(e)))},i.regex=l,i.fn=e.url.toString()}}else if("function"==typeof e.url){var p=e.url;e.url=function(e){return p(e)||p("/".concat(e))}}return e.$meta=i,e},W=r(11),J=r.n(W),I=function(e,t){var r=e.$meta?e.$meta.originalNormal:void 0,n=t.$meta?t.$meta.originalNormal:void 0;return b()(r)&&b()(n)?!(!r||!n)&&(r.url===n.url&&r.path===n.path&&r.method===n.method&&J()(r.query,n.query)&&J()(r.body,n.body)&&J()(r.headers,n.headers)):r===n},z=r(17),G=r.n(z);function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(r,!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var X=function(e,t){return"function"==typeof e?e(t):e},Y=function(e,t,r){var n,a,o,c,i,u,f,l,p,h,d,y,m,b;return s.a.async((function(v){for(;;)switch(v.prev=v.next){case 0:if(n=r.responseHeaders,a=e[1],v.t1=a.status,!v.t1){v.next=7;break}return v.next=6,s.a.awrap(X(a.status,t));case 6:v.t1=v.sent;case 7:if(v.t0=v.t1,v.t0){v.next=10;break}v.t0=200;case 10:if(o=v.t0,v.t2=a.type,!v.t2){v.next=16;break}return v.next=15,s.a.awrap(a.type);case 15:v.t2=v.sent;case 16:if(i=v.t2,u="function"==typeof i?i(t):i,!a.fixture){v.next=35;break}if(r.fixtureResolver){v.next=21;break}throw new Error("Using `fixture` in mock response options requires a `fixtureResolver`.");case 21:return v.next=23,s.a.awrap(X(a.fixture,t));case 23:if(p=v.sent,u=u||p,!p){v.next=31;break}return v.next=28,s.a.awrap(r.fixtureResolver(p));case 28:v.t3=v.sent,v.next=32;break;case 31:v.t3=void 0;case 32:c=v.t3,v.next=79;break;case 35:if(!a.filePath){v.next=52;break}if(r.fileResolver){v.next=38;break}throw new Error("Using `filePath` in mock response options requires a `fileResolver`.");case 38:return v.next=40,s.a.awrap(X(a.filePath,t));case 40:if(h=v.sent,u=u||h,!h){v.next=48;break}return v.next=45,s.a.awrap(r.fileResolver(h));case 45:v.t4=v.sent,v.next=49;break;case 48:v.t4=void 0;case 49:c=v.t4,v.next=79;break;case 52:if(!a.json){v.next=60;break}return v.next=55,s.a.awrap(X(a.json,t));case 55:l=v.sent,c=JSON.stringify(l),f="application/json; charset=UTF-8",v.next=79;break;case 60:if(!a.text){v.next=67;break}return v.next=63,s.a.awrap(X(a.text,t));case 63:c=v.sent,f="text/plain; charset=UTF-8",v.next=79;break;case 67:if(!a.html){v.next=74;break}return v.next=70,s.a.awrap(X(a.html,t));case 70:c=v.sent,f="text/html; charset=UTF-8",v.next=79;break;case 74:if(!a.raw){v.next=79;break}return v.next=77,s.a.awrap(X(a.raw,t));case 77:c=v.sent,f=void 0;case 79:return c=c||"",f=u?G.a.getType(u):f,v.t5=V,v.t6={},v.next=85,s.a.awrap(X(a.headers,t));case 85:if(v.t7=v.sent,d=(0,v.t5)(v.t6,v.t7),n&&(d["x-mockyeah-mocked"]="true"),f&&(d["content-type"]=f),y={status:o,headers:d},!a.latency){v.next=96;break}return v.next=93,s.a.awrap(X(a.latency,t));case 93:return m=v.sent,v.next=96,s.a.awrap(new Promise((function(e){return setTimeout(e,m)})));case 96:return b=new Response(c,y),v.abrupt("return",{response:b,json:l});case 98:case"end":return v.stop()}}))},Z=r(18),ee=r.n(Z),te=r(19),re=r.n(te),ne=r(1),ae=r.n(ne),oe=function(e){return e&&(e instanceof Promise||!(!e.then||!e.catch))},ce=function(e,t,r){var n=q()(e,t,{skipKeys:["$meta"]}),a=n.result,o=n.message;ae()(a,"".concat(r,": ").concat(o))},ie=function(){function e(t){p()(this,e);var r=t.$meta&&t.$meta.originalNormal?t.$meta.originalNormal:t;this.prefix="[".concat(r.method||"get","] ").concat(r.path||r.url," --"),this.called=0,this.assertions=[],this.handlers=[],this.verifier=this.verifier.bind(this),this.run=this.run.bind(this),this.verify=this.verify.bind(this)}return re()(e,[{key:"request",value:function(e){var t=this;this.called+=1,this.handlers.forEach((function(r){t.assertions.push(r.bind(t,e))}))}},{key:"api",value:function(e){var t=this;if("function"==typeof e){var r=e;this.handlers.push((function(e){try{var n=r(e);if(void 0!==n&&!n)throw new Error("function returned false")}catch(e){var a="".concat(t.prefix," Expect function did not match").concat(e&&e.message?": ".concat(e.message):"");ae()(!1,a)}}))}else if("object"===ee()(e)){var n=K(e);this.handlers.push((function(e){var t=q()(e,n,{skipKeys:["$meta"]}),r=t.result,a=t.message;ae()(r,"Expect object did not match: ".concat(a))}))}return this}},{key:"atLeast",value:function(e){var t=this;return this.assertions.push((function(){ae()(t.called>=e,"".concat(t.prefix," Expected route to be called at least ").concat(e," times, but it was called ").concat(t.called," times"))})),this}},{key:"atMost",value:function(e){var t=this;return this.assertions.push((function(){ae()(t.called<=e,"".concat(t.prefix," Expected route to be called at most ").concat(e," times, but it was called ").concat(t.called," times"))})),this}},{key:"never",value:function(){var e=this;return this.assertions.push((function(){ae()(0===e.called,"".concat(e.prefix," Expected route to be called never, but it was called ").concat(e.called," times"))})),this}},{key:"once",value:function(){var e=this;return this.assertions.push((function(){ae()(1===e.called,"".concat(e.prefix," Expected route to be called once, but it was called ").concat(e.called," times"))})),this}},{key:"twice",value:function(){var e=this;return this.assertions.push((function(){ae()(2===e.called,"".concat(e.prefix," Expected route to be called twice, but it was called ").concat(e.called," times"))})),this}},{key:"thrice",value:function(){var e=this;return this.assertions.push((function(){ae()(3===e.called,"".concat(e.prefix," Expected route to be called thrice, but it was called ").concat(e.called," times"))})),this}},{key:"exactly",value:function(e){var t=this;return this.assertions.push((function(){ae()(t.called===e,"".concat(t.prefix," Expected route to be called ").concat(e," times, but it was called ").concat(t.called," times"))})),this}},{key:"path",value:function(e){var t="".concat(this.prefix," Path did not match expected");return this.handlers.push((function(r){var n=r.path;ce(n,e,t)})),this}},{key:"url",value:function(e){return this.path(e)}},{key:"header",value:function(e,t){var r="".concat(this.prefix,' Header "').concat(e,'" did not match expected');return this.handlers.push((function(n){ce(n.headers&&(n.headers[e]||n.headers[e.toLowerCase()]),t,r)})),this}},{key:"params",value:function(e){var t="".concat(this.prefix," Params did not match expected");return this.handlers.push((function(r){ce(r.query,e,t)})),this}},{key:"query",value:function(e){return this.params(e)}},{key:"body",value:function(e){var t="".concat(this.prefix," Body did not match expected");return this.handlers.push((function(r){ce(r.body,e,t)})),this}},{key:"verifier",value:function(e){var t=this;return function(r){r?e(r):t.verify(e)}}},{key:"run",value:function(e){return oe(e)?this.runPromise=e:this.runPromise=new Promise((function(t,r){setTimeout((function(){var n=e((function(e){e?r(e):t()}));oe(n)&&n.then(t).catch(r)}))})),this}},{key:"verify",value:function(e){var t=this,r=function(t){if(!e)throw t;e(t)},n=function(){try{t.assertions.forEach((function(e){return e()})),e&&e()}catch(e){r(e)}};if(this.runPromise)return this.runPromise.then(n).catch(r);n()}}]),e}(),se=["fixture","filePath","html","json","text","status","headers","raw","latency","type"];function ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ue(r,!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ue(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var le=O()("mockyeah:fetch:mock"),pe=O()("mockyeah:fetch:miss"),he=O()("mockyeah:fetch:miss:each"),de=O()("mockyeah:fetch:error"),ye={};t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye;p()(this,e);var r=t.proxy,n=t.prependServerURL,o=t.noPolyfill,i=t.host,u=void 0===i?"localhost":i,l=t.port,d=void 0===l?4001:l,m=t.portHttps,v=t.suiteHeader,k=void 0===v?"x-mockyeah-suite":v,g=t.suiteCookie,O=void 0===g?"mockyeahSuite":g,j=t.ignorePrefix,P=void 0===j?"http".concat(m?"s":"","://").concat(u,":").concat(m||d,"/"):j,E=t.aliases,$=t.responseHeaders,S=void 0===$||$,D=t.fetch,R=void 0===D?global.fetch:D;if(!R){var T="@mockyeah/fetch requires a fetch implementation";throw de(T),new Error(T)}var C="http".concat(m?"s":"","://").concat(u,":").concat(m||d),H=[],L=function(e,t){var r=K(e),n=H.findIndex((function(e){return I(r,e[0])}));n>=0&&H.splice(n,1);var a="string"==typeof t?{text:t}:t;if(a=a||{status:200},Object.keys(a).some((function(e){return!se.includes(e)}))){var o="Response option(s) invalid. Options must include one of the following: ".concat(se.join(", "));throw de(o),new Error(o)}return r.$meta&&(r.$meta.expectation=new ie(r)),[r,a]},N=function(e,t){var r=L(e,t);H.push(r);var n=r[0].$meta&&r[0].$meta.expectation,a=n.api.bind(n);return{expect:function(e){return a(e)}.bind(n)}},M=function(e,t){return fe({},b()(e)?e:{url:e},{method:t})},U=function(e,t){var r,n,a,o,c,i,u,f,l,p,h=arguments;return s.a.async((function(d){for(;;)switch(d.prev=d.next){case 0:if(r=h.length>2&&void 0!==h[2]?h[2]:{},n=r.proxy,a="string"==typeof e?e:e.url,n&&a.startsWith("http")){d.next=7;break}return o={},S&&(o["x-mockyeah-missed"]="true"),d.abrupt("return",new Response(void 0,{status:404,headers:o}));case 7:return d.next=9,s.a.awrap(R(e,t));case 9:return c=d.sent,S&&(u=(i=c).status,f=i.statusText,l=i.headers,(p=l&&new Headers(l))&&(p.set("x-mockyeah-proxied","true"),p.set("x-mockyeah-missed","true")),c=new Response(c.body,{headers:p,status:u,statusText:f})),d.abrupt("return",c);case 12:case"end":return d.stop()}}))},_={};(E||[]).forEach((function(e){e.forEach((function(t){_[t]=e}))}));var F=function(e,o){var i,u,l,p,d,m,v,g,j,E,$,S,D,R,T,N,M,F,A,B,W,J,I,z,G,Q,V,X=arguments;return s.a.async((function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(i=X.length>2&&void 0!==X[2]?X[2]:{},u=i.dynamicMocks,l=i.proxy,p=void 0===l?r:l,d="string"==typeof e?e:e.url,m=o||{},v=(u||[]).map((function(e){return e&&L.apply(void 0,c()(e))})).filter(Boolean),g=Object(h.parse)(d),j=m.headers?m.headers instanceof Headers?m.headers:new Headers(m.headers):void 0,!m.body||"string"==typeof m.body){Z.next=9;break}return de("@mockyeah/fetch does not yet support non-string request bodies, falling back to normal fetch"),Z.abrupt("return",U(d,o));case 9:if(E=j&&j.get("Content-Type"),$=E&&E.includes("application/json"),S=m.body&&$?JSON.parse(m.body):m.body,D=g.query?y.a.parse(g.query):void 0,R=m.method?m.method.toLowerCase():"get",!m.headers||b()(m.headers)){Z.next=17;break}return de("@mockyeah/fetch does not yet support non-object request headers, falling back to normal fetch"),Z.abrupt("return",U(d,o));case 17:if(T=m.headers,[N={url:d.replace(P,""),query:D,headers:T,body:S,method:R}].concat(c()(x()(Object.entries(_).map((function(e){var t=a()(e,2),r=t[0],n=t[1];return N.url.replace(/^\//,"").startsWith(r)?n.map((function(e){return fe({},N,{url:d.replace(r,e)})})):[]}))))).filter(Boolean).find((function(e){var t=K(e,!0);return[].concat(c()((v||[]).filter(Boolean)),c()(H)).find((function(e){var r=K(e[0]);return q()(t,r,{skipKeys:["$meta"]}).result?(M=e,!0):(he("@mockyeah/fetch missed mock for",d,{request:N,mock:M}),!1)}))})),F=g.pathname||"/",(B=T&&(T.cookie||T.Cookie))?A=w.a.parse(B):"undefined"!=typeof window&&(A=w.a.parse(window.document.cookie)),W={url:F,path:F,query:D,method:R,headers:T,body:S,cookies:A},!M){Z.next=33;break}return M[0]&&M[0].$meta&&M[0].$meta.expectation&&M[0].$meta.expectation.request(W),Z.next=28,s.a.awrap(Y(M,W,t));case 28:return J=Z.sent,I=J.response,z=J.json,le("@mockyeah/fetch matched mock for",d,{request:W,response:I,json:z,mock:M}),Z.abrupt("return",I);case 33:return pe("@mockyeah/fetch missed all mocks for",d,{request:W}),n&&C&&(d="".concat(C,"/").concat(d.replace("://","~~~"))),"undefined"!=typeof document&&(Q=document.cookie.match("\\b".concat(O,"=([^;]+)\\b")),G=Q&&Q[1]),V=fe({},m,{headers:fe({},m.headers,{},G&&f()({},k,G))}),Z.abrupt("return",U(d,V,{proxy:p}));case 38:case"end":return Z.stop()}}))};o||(global.fetch=F);var A=function(){H=[]},B=function(e,t){return N(e,t)},W=function(e,t){return N(M(e,"get"),t)},J=function(e,t){return N(M(e,"post"),t)},z=function(e,t){return N(M(e,"put"),t)},G=function(e,t){return N(M(e,"delete"),t)},Q=function(e,t){return N(M(e,"options"),t)},V=function(e,t){return N(M(e,"patch"),t)},X={all:B,get:W,post:J,put:z,delete:G,options:Q,patch:V},Z=function(e){return B("*").expect(e)};Object.assign(this,fe({fetch:F,reset:A,mock:N,methods:X,expect:Z},X))}}]).default;